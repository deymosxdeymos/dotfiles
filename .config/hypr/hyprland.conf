# Hyprland Configuration (adapted from outfoxxed's config)

# Load plugins
plugin = /usr/lib/libhy3.so

# Wayland environment variables
env = XDG_SESSION_TYPE,wayland
env = MOZ_ENABLE_WAYLAND,1
env = MOZ_DBUS_REMOTE,1
env = QT_QPA_PLATFORM,wayland
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = GDK_BACKEND,wayland
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = XCURSOR_SIZE,24
env = NIXOS_OZONE_WL,1

exec-once = quickshell
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = systemctl --user start plasma-xdg-desktop-portal-kde.service
exec-once = /home/deymos/.cargo/bin/stash watch

general {
    gaps_in = 3
    gaps_out = 5
    border_size = 1
    col.active_border = rgba(33ccffee)
    col.inactive_border = rgba(595959aa)

    resize_on_border = true
    layout = hy3
}

input {
    kb_layout = us
    kb_options = ctrl:nocaps
    sensitivity = 0
    follow_mouse = 1
    accel_profile = flat
    repeat_delay = 400
    repeat_rate = 100

    touchpad {
        natural_scroll = yes
        tap-to-click = yes
        disable_while_typing = yes
    }
}

decoration {
    rounding = 5

    blur {
        enabled = true
        size = 7
        passes = 4
        noise = 0.008
        contrast = 0.8916
        brightness = 0.8
        input_methods = yes
    }

    shadow {
        enabled = false
    }
}

animations {
    enabled = yes

    bezier = windowIn, 0.06, 0.71, 0.25, 1
    bezier = windowResize, 0.04, 0.67, 0.38, 1
    bezier = workspacesMove, 0.1, 0.75, 0.15, 1

    animation = windowsIn, 1, 3, windowIn, slide
    animation = windowsOut, 1, 3, windowIn, slide
    animation = windowsMove, 1, 2.5, windowResize
    animation = fade, 1, 3, default
    animation = workspaces, 1, 4, workspacesMove, slidevert
    animation = layers, 1, 4, windowIn, slide
}

dwindle {
    pseudotile = yes
    preserve_split = yes
}

master {
    new_status = master
}

gestures {
    workspace_swipe_direction_lock = false
    workspace_swipe_forever = true
    workspace_swipe_cancel_ratio = 0.15
}

gesture = 3, vertical, workspace


misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    key_press_enables_dpms = true
    session_lock_xray = true
    vfr = on
}

render {
    direct_scanout = true
    new_render_scheduling = true
}

binds {
    workspace_back_and_forth = true
}

debug {
    disable_logs = no
    overlay = off
}

monitor = , preferred, auto, 1
monitor = eDP-1, disable

# Layer rules for quickshell
layerrule = blur, shell:bar
layerrule = blurpopups, shell:bar
layerrule = ignorezero, shell:bar
layerrule = blur, shell:notifications
layerrule = ignorezero, shell:notifications
layerrule = noanim, shell:notifications
layerrule = noanim, shell:screenshot
layerrule = blur, shell:launcher
layerrule = ignorezero, shell:launcher
layerrule = animation popin 90%, shell:launcher
layerrule = animation fade, shell:background

# Wofi layer rules
layerrule = blur, wofi
layerrule = ignorezero, wofi
layerrule = noanim, ^(selection)$

# Window rules
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = float, class:^(nm-connection-editor)$
windowrulev2 = float, class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = dimaround, class:^(org.kde.polkit-kde-authentication-agent-1)$
windowrulev2 = float, class:^(gcr-prompter)$
windowrulev2 = dimaround, class:^(gcr-prompter)$
windowrulev2 = float, class:^(org.freedesktop.impl.portal.desktop.kde)$
windowrulev2 = size 1000 700, class:^(org.freedesktop.impl.portal.desktop.kde)$
windowrulev2 = center, class:^(org.freedesktop.impl.portal.desktop.kde)$
windowrulev2 = dimaround, class:^(org.freedesktop.impl.portal.desktop.kde)$
windowrulev2 = float, title:^(OpenSSH Authentication Passphrase request)$
windowrulev2 = float, title:^(KeePassXC -  Access Request)$
windowrulev2 = float, title:^(Unlock Database - KeePassXC)$
windowrulev2 = float, class:^(GhosttyFloating)$

# Fullscreen workspaces (no gaps)
workspace = f[1], gapsout:0, gapsin:0
windowrule = bordersize 0, floating:0, onworkspace:f[1]
windowrule = rounding 0, floating:0, onworkspace:f[1]

# Keybindings
$mod = SUPER
$launcher = quickshell ipc call launcher open
$browser = /home/deymos/AppImages/helium.appimage

# System
bind = $mod+SHIFT, M, exit

# Applications
bind = $mod, Return, exec, ghostty
bind = $mod+SHIFT, Return, exec, ghostty --class=GhosttyFloating
bind = $mod, Space, exec, $launcher
bind = $mod, B, exec, $browser
bind = $mod+SHIFT, Q, hy3:killactive
bind = $mod+SHIFT, V, exec, bash -c 'clip=$(/home/deymos/.cargo/bin/stash list | /usr/bin/wofi --dmenu --width 800 --height 400 --prompt "Clipboard" --insensitive | cut -f1) && [ -n "$clip" ] && /home/deymos/.cargo/bin/stash decode "$clip" | /usr/bin/wl-copy'

# Screenshots and lock
bind = $mod+SHIFT, S, exec, quickshell ipc call screenshot takeScreenshot
bind = $mod, Period, exec, quickshell ipc call lockscreen lock

# Window management
bind = $mod, F, fullscreen, 1
bind = $mod+SHIFT, F, fullscreen, 0
bind = $mod, Tab, hy3:togglefocuslayer
bind = $mod+SHIFT, Tab, togglefloating


# Mouse bindings
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow

# Media keys
bind = , XF86AudioStop, exec, quickshell ipc call mpris pauseAll
bind = , XF86AudioPlay, exec, quickshell ipc call mpris playPause
bind = , XF86AudioNext, exec, quickshell ipc call mpris next
bind = , XF86AudioPrev, exec, quickshell ipc call mpris previous

# Volume controls
bind = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bind = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bind = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle

# Brightness controls
bind = , XF86MonBrightnessUp, exec, brightnessctl set 5%+
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%-

# Keyboard backlight (if applicable)
bind = , XF86KbdBrightnessUp, exec, brightnessctl --device='*::kbd_backlight' set 33%+
bind = , XF86KbdBrightnessDown, exec, brightnessctl --device='*::kbd_backlight' set 33%-

# Workspace switching
bind = $mod, 1, workspace, 01
bind = $mod, 2, workspace, 02
bind = $mod, 3, workspace, 03
bind = $mod, 4, workspace, 04
bind = $mod, 5, workspace, 05
bind = $mod, 6, workspace, 06
bind = $mod, 7, workspace, 07
bind = $mod, 8, workspace, 08
bind = $mod, 9, workspace, 09
bind = $mod, 0, workspace, 10

# Move window to workspace (with hy3)
bind = $mod+SHIFT, 1, hy3:movetoworkspace, 01
bind = $mod+SHIFT, 2, hy3:movetoworkspace, 02
bind = $mod+SHIFT, 3, hy3:movetoworkspace, 03
bind = $mod+SHIFT, 4, hy3:movetoworkspace, 04
bind = $mod+SHIFT, 5, hy3:movetoworkspace, 05
bind = $mod+SHIFT, 6, hy3:movetoworkspace, 06
bind = $mod+SHIFT, 7, hy3:movetoworkspace, 07
bind = $mod+SHIFT, 8, hy3:movetoworkspace, 08
bind = $mod+SHIFT, 9, hy3:movetoworkspace, 09
bind = $mod+SHIFT, 0, hy3:movetoworkspace, 10

# Secondary workspaces (F1-F10 for workspaces 11-20)
bind = $mod, F1, workspace, 11
bind = $mod, F2, workspace, 12
bind = $mod, F3, workspace, 13
bind = $mod, F4, workspace, 14
bind = $mod, F5, workspace, 15
bind = $mod, F6, workspace, 16
bind = $mod, F7, workspace, 17
bind = $mod, F8, workspace, 18
bind = $mod, F9, workspace, 19
bind = $mod, F10, workspace, 20

bind = $mod+SHIFT, F1, hy3:movetoworkspace, 11
bind = $mod+SHIFT, F2, hy3:movetoworkspace, 12
bind = $mod+SHIFT, F3, hy3:movetoworkspace, 13
bind = $mod+SHIFT, F4, hy3:movetoworkspace, 14
bind = $mod+SHIFT, F5, hy3:movetoworkspace, 15
bind = $mod+SHIFT, F6, hy3:movetoworkspace, 16
bind = $mod+SHIFT, F7, hy3:movetoworkspace, 17
bind = $mod+SHIFT, F8, hy3:movetoworkspace, 18
bind = $mod+SHIFT, F9, hy3:movetoworkspace, 19
bind = $mod+SHIFT, F10, hy3:movetoworkspace, 20

# ============================================
# HY3 PLUGIN BINDINGS
# ============================================

# Group management
bind = $mod, D, hy3:makegroup, h
bind = $mod, S, hy3:makegroup, v
bind = $mod, Z, hy3:makegroup, tab
bind = $mod, A, hy3:changefocus, raise
bind = $mod+SHIFT, A, hy3:changefocus, lower
bind = $mod, X, hy3:locktab
bind = $mod, E, hy3:expand, expand
bind = $mod+SHIFT, E, hy3:expand, base
bind = $mod, R, hy3:changegroup, opposite
bind = $mod, W, hy3:warpcursor

# Tab navigation
bindn = , mouse_down, hy3:focustab, l, require_hovered
bindn = , mouse_up, hy3:focustab, r, require_hovered

bind = $mod+CONTROL, 1, hy3:focustab, index, 01
bind = $mod+CONTROL, 2, hy3:focustab, index, 02
bind = $mod+CONTROL, 3, hy3:focustab, index, 03
bind = $mod+CONTROL, 4, hy3:focustab, index, 04
bind = $mod+CONTROL, 5, hy3:focustab, index, 05
bind = $mod+CONTROL, 6, hy3:focustab, index, 06
bind = $mod+CONTROL, 7, hy3:focustab, index, 07
bind = $mod+CONTROL, 8, hy3:focustab, index, 08
bind = $mod+CONTROL, 9, hy3:focustab, index, 09
bind = $mod+CONTROL, 0, hy3:focustab, index, 10

# Tab title visibility toggle (hold I or O to show titles)
bind = $mod, I, exec, hyprctl keyword plugin:hy3:tabs:height 20
bind = $mod, I, exec, hyprctl keyword plugin:hy3:tabs:render_text true
bind = $mod, O, exec, hyprctl keyword plugin:hy3:tabs:height 20
bind = $mod, O, exec, hyprctl keyword plugin:hy3:tabs:render_text true
bindr = $mod, O, exec, hyprctl keyword plugin:hy3:tabs:height 2
bindr = $mod, O, exec, hyprctl keyword plugin:hy3:tabs:render_text false

# Override focus movement to use hy3
bind = $mod, H, hy3:movefocus, l
bind = $mod, J, hy3:movefocus, d
bind = $mod, K, hy3:movefocus, u
bind = $mod, L, hy3:movefocus, r
bind = $mod, Left, hy3:movefocus, l
bind = $mod, Down, hy3:movefocus, d
bind = $mod, Up, hy3:movefocus, u
bind = $mod, Right, hy3:movefocus, r

# Focus movement (visible only, no cursor warp)
bind = $mod+CONTROL, H, hy3:movefocus, l, visible, nowarp
bind = $mod+CONTROL, J, hy3:movefocus, d, visible, nowarp
bind = $mod+CONTROL, K, hy3:movefocus, u, visible, nowarp
bind = $mod+CONTROL, L, hy3:movefocus, r, visible, nowarp
bind = $mod+CONTROL, Left, hy3:movefocus, l, visible, nowarp
bind = $mod+CONTROL, Down, hy3:movefocus, d, visible, nowarp
bind = $mod+CONTROL, Up, hy3:movefocus, u, visible, nowarp
bind = $mod+CONTROL, Right, hy3:movefocus, r, visible, nowarp

# Override window movement to use hy3
bind = $mod+SHIFT, H, hy3:movewindow, l, once
bind = $mod+SHIFT, J, hy3:movewindow, d, once
bind = $mod+SHIFT, K, hy3:movewindow, u, once
bind = $mod+SHIFT, L, hy3:movewindow, r, once
bind = $mod+SHIFT, Left, hy3:movewindow, l, once
bind = $mod+SHIFT, Down, hy3:movewindow, d, once
bind = $mod+SHIFT, Up, hy3:movewindow, u, once
bind = $mod+SHIFT, Right, hy3:movewindow, r, once

# Move windows (visible only)
bind = $mod+CONTROL+SHIFT, H, hy3:movewindow, l, once, visible
bind = $mod+CONTROL+SHIFT, J, hy3:movewindow, d, once, visible
bind = $mod+CONTROL+SHIFT, K, hy3:movewindow, u, once, visible
bind = $mod+CONTROL+SHIFT, L, hy3:movewindow, r, once, visible
bind = $mod+CONTROL+SHIFT, Left, hy3:movewindow, l, once, visible
bind = $mod+CONTROL+SHIFT, Down, hy3:movewindow, d, once, visible
bind = $mod+CONTROL+SHIFT, Up, hy3:movewindow, u, once, visible
bind = $mod+CONTROL+SHIFT, Right, hy3:movewindow, r, once, visible

# hy3 plugin configuration
plugin {
    hy3 {
        tabs {
            border_width = 1
            col.active = rgba(33ccff20)
            col.active.border = rgba(33ccffee)
            col.inactive = rgba(30303020)
            col.inactive.border = rgba(595959aa)
            col.urgent = rgba(ff223340)
            col.urgent.border = rgba(ff2233ee)
        }

        autotile {
            enable = true
            trigger_width = 800
            trigger_height = 500
        }
    }
}
